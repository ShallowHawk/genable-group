# ğŸ› ï¸ Vue3 + TypeScript + i18n å›½é™…åŒ–å®Œæ•´ä¿®å¤æ–‡æ¡£

## ğŸš¨ **é—®é¢˜åˆ†æ**

æ ¹æ®æ§åˆ¶å°é”™è¯¯ä¿¡æ¯ï¼Œä¸»è¦é—®é¢˜åŒ…æ‹¬ï¼š

1. **è¯­æ³•é”™è¯¯**ï¼š`SyntaxError: Not support non-string message`
2. **æ¸²æŸ“é”™è¯¯**ï¼š`Unhandled error during execution of render function`
3. **é…ç½®é”™è¯¯**ï¼ši18n é…ç½®ä¸æ­£ç¡®

## ğŸ“‹ **ä¿®å¤æ­¥éª¤æ¸…å•**

### **æ­¥éª¤ 1ï¼šæ¸…ç†å’Œé‡æ–°å®‰è£…ä¾èµ–**

```bash
# åˆ é™¤ node_modules å’Œ package-lock.json
rm -rf node_modules package-lock.json

# é‡æ–°å®‰è£…ä¾èµ–
npm install

# å®‰è£… vue-i18n (ç¡®ä¿ç‰ˆæœ¬æ­£ç¡®)
npm install vue-i18n@9 --save
npm install @intlify/unplugin-vue-i18n --save-dev
```

---

### **æ­¥éª¤ 2ï¼šåˆ›å»ºæ­£ç¡®çš„æ–‡ä»¶ç»“æ„**

```
src/
â”œâ”€â”€ i18n/
â”‚   â”œâ”€â”€ index.ts
â”‚   â””â”€â”€ locales/
â”‚       â”œâ”€â”€ zh.json
â”‚       â””â”€â”€ en.json
â”œâ”€â”€ components/
â”‚   â””â”€â”€ LanguageSwitcher.vue
â””â”€â”€ views/
    â””â”€â”€ TheHeader.vue
```

---

### **æ­¥éª¤ 3ï¼šåˆ›å»ºè¯­è¨€æ–‡ä»¶**

**ğŸ“ src/i18n/locales/zh.json**

```json
{
  "common": {
    "siteName": "å¯è€åšè¾¾",
    "contactUs": "è”ç³»æˆ‘ä»¬",
    "loading": "åŠ è½½ä¸­...",
    "error": "å‡ºé”™äº†"
  },
  "nav": {
    "home": "é¦–é¡µ",
    "services": "æœåŠ¡",
    "about": "å…³äºæˆ‘ä»¬",
    "contact": "è”ç³»æˆ‘ä»¬",
    "products": "äº§å“"
  },
  "buttons": {
    "getQuote": "è·å–æŠ¥ä»·",
    "learnMore": "äº†è§£æ›´å¤š",
    "submit": "æäº¤",
    "cancel": "å–æ¶ˆ"
  }
}
```

**ğŸ“ src/i18n/locales/en.json**

```json
{
  "common": {
    "siteName": "Kenable",
    "contactUs": "Contact Us",
    "loading": "Loading...",
    "error": "Error occurred"
  },
  "nav": {
    "home": "Home",
    "services": "Services",
    "about": "About Us",
    "contact": "Contact",
    "products": "Products"
  },
  "buttons": {
    "getQuote": "Get Quote",
    "learnMore": "Learn More",
    "submit": "Submit",
    "cancel": "Cancel"
  }
}
```

---

### **æ­¥éª¤ 4ï¼šåˆ›å»º i18n é…ç½®æ–‡ä»¶**

**ğŸ“ src/i18n/index.ts**

```typescript
import { createI18n } from 'vue-i18n'

// å¯¼å…¥è¯­è¨€æ–‡ä»¶
import zh from './locales/zh.json'
import en from './locales/en.json'

// ç±»å‹å®šä¹‰
export type MessageLanguages = 'zh' | 'en'
export type MessageSchema = typeof zh

// è¯­è¨€é…ç½®
const messages = {
  zh,
  en,
}

// è·å–é»˜è®¤è¯­è¨€
function getDefaultLocale(): MessageLanguages {
  // 1. æ£€æŸ¥ localStorage
  const saved = localStorage.getItem('locale')
  if (saved && (saved === 'zh' || saved === 'en')) {
    return saved as MessageLanguages
  }

  // 2. æ£€æŸ¥æµè§ˆå™¨è¯­è¨€
  const browserLang = navigator.language.toLowerCase()
  if (browserLang.includes('zh')) {
    return 'zh'
  }

  // 3. é»˜è®¤ä¸­æ–‡
  return 'zh'
}

// åˆ›å»º i18n å®ä¾‹
const i18n = createI18n<[MessageSchema], MessageLanguages>({
  legacy: false, // ä½¿ç”¨ Composition API
  locale: getDefaultLocale(),
  fallbackLocale: 'zh',
  messages,
  globalInjection: true, // å…¨å±€æ³¨å…¥ $t
  missingWarn: false, // å…³é—­ç¼ºå¤±è­¦å‘Š
  fallbackWarn: false, // å…³é—­å›é€€è­¦å‘Š
})

export default i18n

// å¯¼å‡ºå·¥å…·å‡½æ•°
export function setLocale(locale: MessageLanguages) {
  i18n.global.locale.value = locale
  localStorage.setItem('locale', locale)
}

export function getCurrentLocale(): MessageLanguages {
  return i18n.global.locale.value
}
```

---

### **æ­¥éª¤ 5ï¼šä¿®æ”¹ main.ts**

**ğŸ“ src/main.ts**

```typescript
import { createApp } from 'vue'
import App from './App.vue'
import router from './router'
import i18n from './i18n'

// åˆ›å»ºåº”ç”¨å®ä¾‹
const app = createApp(App)

// å…¨å±€é”™è¯¯å¤„ç†ï¼ˆè°ƒè¯•ç”¨ï¼‰
app.config.errorHandler = (err, instance, info) => {
  console.error('ğŸš¨ Global Error:', err)
  console.error('ğŸ” Component:', instance)
  console.error('ğŸ“ Info:', info)
}

// æ³¨å†Œæ’ä»¶
app.use(i18n)
app.use(router)

// æŒ‚è½½åº”ç”¨
app.mount('#app')

console.log('âœ… App initialized successfully')
console.log('ğŸŒ i18n locale:', i18n.global.locale.value)
```

---

### **æ­¥éª¤ 6ï¼šåˆ›å»ºè¯­è¨€åˆ‡æ¢ç»„ä»¶**

**ğŸ“ src/components/LanguageSwitcher.vue**

```vue
<template>
  <div class="language-switcher">
    <button
      v-for="lang in languages"
      :key="lang.code"
      :class="['lang-btn', { active: currentLocale === lang.code }]"
      @click="switchLanguage(lang.code)"
      :aria-label="`Switch to ${lang.name}`"
    >
      {{ lang.name }}
    </button>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { useI18n } from 'vue-i18n'
import type { MessageLanguages } from '@/i18n'

// è¯­è¨€é€‰é¡¹
const languages = [
  { code: 'zh' as MessageLanguages, name: 'ä¸­æ–‡' },
  { code: 'en' as MessageLanguages, name: 'EN' },
]

// ä½¿ç”¨ i18n
const { locale } = useI18n()

// å½“å‰è¯­è¨€
const currentLocale = computed(() => locale.value)

// åˆ‡æ¢è¯­è¨€
const switchLanguage = (langCode: MessageLanguages) => {
  try {
    console.log('ğŸ”„ Switching language to:', langCode)

    // è®¾ç½®è¯­è¨€
    locale.value = langCode

    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
    localStorage.setItem('locale', langCode)

    console.log('âœ… Language switched successfully')
  } catch (error) {
    console.error('âŒ Error switching language:', error)
  }
}
</script>

<style scoped>
.language-switcher {
  display: flex;
  align-items: center;
  gap: 4px;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  padding: 2px;
  background: #f8fafc;
}

.lang-btn {
  padding: 6px 12px;
  border: none;
  background: transparent;
  color: #64748b;
  font-size: 14px;
  font-weight: 500;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
  min-width: 44px;
}

.lang-btn:hover {
  background: #e2e8f0;
  color: #334155;
}

.lang-btn.active {
  background: #3b82f6;
  color: white;
  font-weight: 600;
}

.lang-btn:focus {
  outline: 2px solid #3b82f6;
  outline-offset: 2px;
}
</style>
```

---

### **æ­¥éª¤ 7ï¼šä¿®æ”¹ TheHeader.vue**

**ğŸ“ src/components/TheHeader.vue**

```vue
<template>
  <header class="header">
    <div class="header-container">
      <!-- Logo -->
      <div class="logo">
        <router-link to="/" class="logo-link">
          {{ $t('common.siteName') }}
        </router-link>
      </div>

      <!-- å¯¼èˆªèœå• -->
      <nav class="nav-menu" role="navigation">
        <router-link to="/" class="nav-link">
          {{ $t('nav.home') }}
        </router-link>
        <router-link to="/services" class="nav-link">
          {{ $t('nav.services') }}
        </router-link>
        <router-link to="/about" class="nav-link">
          {{ $t('nav.about') }}
        </router-link>
        <router-link to="/contact" class="nav-link">
          {{ $t('nav.contact') }}
        </router-link>
      </nav>

      <!-- å³ä¾§æ“ä½œåŒº -->
      <div class="header-actions">
        <!-- è¯­è¨€åˆ‡æ¢å™¨ -->
        <LanguageSwitcher />

        <!-- è”ç³»æŒ‰é’® -->
        <button class="contact-btn" @click="handleContact">
          {{ $t('common.contactUs') }}
        </button>
      </div>
    </div>
  </header>
</template>

<script setup lang="ts">
import { onMounted } from 'vue'
import LanguageSwitcher from './LanguageSwitcher.vue'

// è”ç³»æˆ‘ä»¬å¤„ç†
const handleContact = () => {
  // è¿™é‡Œå¯ä»¥æ·»åŠ è”ç³»æˆ‘ä»¬çš„é€»è¾‘
  console.log('Contact us clicked')
}

// ç»„ä»¶æŒ‚è½½åçš„è°ƒè¯•ä¿¡æ¯
onMounted(() => {
  console.log('âœ… TheHeader mounted successfully')
})
</script>

<style scoped>
.header {
  background: #ffffff;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  position: sticky;
  top: 0;
  z-index: 100;
}

.header-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 24px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 64px;
}

.logo-link {
  font-size: 24px;
  font-weight: 700;
  color: #1f2937;
  text-decoration: none;
  transition: color 0.2s ease;
}

.logo-link:hover {
  color: #3b82f6;
}

.nav-menu {
  display: flex;
  align-items: center;
  gap: 32px;
}

.nav-link {
  color: #4b5563;
  text-decoration: none;
  font-weight: 500;
  font-size: 16px;
  transition: color 0.2s ease;
  position: relative;
}

.nav-link:hover {
  color: #3b82f6;
}

.nav-link.router-link-active {
  color: #3b82f6;
}

.nav-link.router-link-active::after {
  content: '';
  position: absolute;
  bottom: -8px;
  left: 0;
  right: 0;
  height: 2px;
  background: #3b82f6;
  border-radius: 1px;
}

.header-actions {
  display: flex;
  align-items: center;
  gap: 16px;
}

.contact-btn {
  background: #3b82f6;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  font-weight: 500;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.contact-btn:hover {
  background: #2563eb;
  transform: translateY(-1px);
}

.contact-btn:active {
  transform: translateY(0);
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .header-container {
    padding: 0 16px;
  }

  .nav-menu {
    display: none; /* ç§»åŠ¨ç«¯éšè—å¯¼èˆªï¼Œå¯ä»¥æ·»åŠ æ±‰å ¡èœå• */
  }

  .contact-btn {
    padding: 6px 12px;
    font-size: 13px;
  }
}
</style>
```

---

### **æ­¥éª¤ 8ï¼šæ›´æ–° Vite é…ç½®**

**ğŸ“ vite.config.ts**

```typescript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import VueI18nPlugin from '@intlify/unplugin-vue-i18n/vite'
import { resolve, dirname } from 'node:path'
import { fileURLToPath } from 'url'

export default defineConfig({
  plugins: [
    vue(),
    VueI18nPlugin({
      include: resolve(dirname(fileURLToPath(import.meta.url)), './src/i18n/locales/**'),
      runtimeOnly: false,
    }),
  ],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
    },
  },
  server: {
    port: 5175,
    host: true,
  },
})
```

---

### **æ­¥éª¤ 9ï¼šæ›´æ–° tsconfig.json**

**ğŸ“ tsconfig.json**

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "preserve",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  },
  "include": ["src/**/*.ts", "src/**/*.d.ts", "src/**/*.tsx", "src/**/*.vue"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

---

### **æ­¥éª¤ 10ï¼šåˆ›å»ºè°ƒè¯•é¡µé¢ï¼ˆå¯é€‰ï¼‰**

**ğŸ“ src/views/DebugView.vue**

```vue
<template>
  <div class="debug-container">
    <h1>ğŸ”§ i18n è°ƒè¯•é¢æ¿</h1>

    <div class="debug-section">
      <h3>åŸºç¡€ä¿¡æ¯</h3>
      <p>
        å½“å‰è¯­è¨€: <code>{{ currentLocale }}</code>
      </p>
      <p>
        å¯ç”¨è¯­è¨€: <code>{{ availableLocales.join(', ') }}</code>
      </p>
      <p>æ—¶é—´æˆ³: {{ new Date().toLocaleString() }}</p>
    </div>

    <div class="debug-section">
      <h3>ç¿»è¯‘æµ‹è¯•</h3>
      <table class="debug-table">
        <thead>
          <tr>
            <th>Key</th>
            <th>ä¸­æ–‡</th>
            <th>è‹±æ–‡</th>
            <th>å½“å‰å€¼</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="testKey in testKeys" :key="testKey">
            <td>
              <code>{{ testKey }}</code>
            </td>
            <td>{{ getTranslation(testKey, 'zh') }}</td>
            <td>{{ getTranslation(testKey, 'en') }}</td>
            <td>
              <strong>{{ $t(testKey) }}</strong>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="debug-section">
      <h3>åŠŸèƒ½æµ‹è¯•</h3>
      <button @click="testLanguageSwitch">ğŸ”„ æµ‹è¯•è¯­è¨€åˆ‡æ¢</button>
      <button @click="testMissingKey">âš ï¸ æµ‹è¯•ç¼ºå¤±Key</button>
      <button @click="clearStorage">ğŸ—‘ï¸ æ¸…é™¤å­˜å‚¨</button>
    </div>

    <div v-if="debugLogs.length" class="debug-section">
      <h3>è°ƒè¯•æ—¥å¿—</h3>
      <div class="debug-logs">
        <div v-for="(log, index) in debugLogs" :key="index" class="debug-log">
          <span class="log-time">{{ log.time }}</span>
          <span :class="`log-${log.type}`">{{ log.message }}</span>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue'
import { useI18n } from 'vue-i18n'

const { t, locale, availableLocales } = useI18n()

const currentLocale = computed(() => locale.value)

const testKeys = ['common.siteName', 'nav.home', 'nav.services', 'buttons.getQuote']

const debugLogs = ref<Array<{ time: string; type: string; message: string }>>([])

const addLog = (type: string, message: string) => {
  debugLogs.value.unshift({
    time: new Date().toLocaleTimeString(),
    type,
    message,
  })
  if (debugLogs.value.length > 10) {
    debugLogs.value.pop()
  }
}

const getTranslation = (key: string, lang: string) => {
  const originalLocale = locale.value
  locale.value = lang
  const translation = t(key)
  locale.value = originalLocale
  return translation
}

const testLanguageSwitch = () => {
  const newLang = locale.value === 'zh' ? 'en' : 'zh'
  locale.value = newLang
  addLog('info', `è¯­è¨€åˆ‡æ¢åˆ°: ${newLang}`)
}

const testMissingKey = () => {
  try {
    const result = t('non.existing.key')
    addLog('warning', `ç¼ºå¤±Keyæµ‹è¯•: ${result}`)
  } catch (error) {
    addLog('error', `ç¼ºå¤±Keyé”™è¯¯: ${error}`)
  }
}

const clearStorage = () => {
  localStorage.removeItem('locale')
  addLog('info', 'å·²æ¸…é™¤æœ¬åœ°å­˜å‚¨')
}
</script>

<style scoped>
.debug-container {
  max-width: 1000px;
  margin: 20px auto;
  padding: 20px;
  font-family: monospace;
}

.debug-section {
  margin: 20px 0;
  padding: 15px;
  border: 1px solid #ddd;
  border-radius: 8px;
  background: #f9f9f9;
}

.debug-table {
  width: 100%;
  border-collapse: collapse;
  margin: 10px 0;
}

.debug-table th,
.debug-table td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: left;
}

.debug-table th {
  background: #f5f5f5;
  font-weight: bold;
}

.debug-logs {
  max-height: 200px;
  overflow-y: auto;
  background: #000;
  color: #fff;
  padding: 10px;
  border-radius: 4px;
}

.debug-log {
  margin: 2px 0;
  font-size: 12px;
}

.log-time {
  color: #888;
  margin-right: 10px;
}

.log-info {
  color: #4caf50;
}
.log-warning {
  color: #ff9800;
}
.log-error {
  color: #f44336;
}

button {
  margin: 5px;
  padding: 8px 16px;
  border: none;
  border-radius: 4px;
  background: #007bff;
  color: white;
  cursor: pointer;
}

button:hover {
  background: #0056b3;
}

code {
  background: #f1f1f1;
  padding: 2px 4px;
  border-radius: 3px;
  font-size: 12px;
}
</style>
```

---

## ğŸš€ **æ‰§è¡Œæ­¥éª¤**

### **1. ç«‹å³æ“ä½œ**

```bash
# 1. åœæ­¢å¼€å‘æœåŠ¡å™¨
Ctrl + C

# 2. æ¸…ç†é¡¹ç›®
rm -rf node_modules package-lock.json

# 3. é‡æ–°å®‰è£…
npm install
npm install vue-i18n@9 @intlify/unplugin-vue-i18n

# 4. é‡å¯æœåŠ¡å™¨
npm run dev
```

### **2. æ–‡ä»¶æ›¿æ¢é¡ºåº**

1. å…ˆåˆ›å»º `src/i18n/` ç›®å½•å’Œè¯­è¨€æ–‡ä»¶
2. æ›¿æ¢ `src/i18n/index.ts`
3. æ›¿æ¢ `src/main.ts`
4. åˆ›å»º `src/components/LanguageSwitcher.vue`
5. æ›¿æ¢ `src/components/TheHeader.vue`
6. æ›´æ–° `vite.config.ts`

### **3. éªŒè¯æ­¥éª¤**

1. é¡µé¢èƒ½æ­£å¸¸æ˜¾ç¤º
2. è¯­è¨€åˆ‡æ¢åŠŸèƒ½æ­£å¸¸
3. æ§åˆ¶å°æ— é”™è¯¯ä¿¡æ¯
4. ç¿»è¯‘æ–‡æœ¬æ­£ç¡®æ˜¾ç¤º

---

## ğŸ”§ **æ•…éšœæ’é™¤**

### **å¦‚æœä»æœ‰é”™è¯¯ï¼š**

1. **æ£€æŸ¥æ–‡ä»¶è·¯å¾„**ï¼šç¡®ä¿æ‰€æœ‰æ–‡ä»¶è·¯å¾„æ­£ç¡®
2. **æ£€æŸ¥å¯¼å…¥**ï¼šç¡®ä¿æ‰€æœ‰ import è¯­å¥æ­£ç¡®
3. **æ¸…é™¤ç¼“å­˜**ï¼š
   ```bash
   rm -rf node_modules/.vite
   npm run dev
   ```
4. **æ£€æŸ¥è¯­æ³•**ï¼šä½¿ç”¨ VS Code æ£€æŸ¥ JSON è¯­æ³•é”™è¯¯
5. **é€æ­¥æµ‹è¯•**ï¼šå…ˆæ³¨é‡Šæ‰ LanguageSwitcherï¼Œç¡®ä¿åŸºç¡€ i18n å·¥ä½œ

### **å¸¸è§é—®é¢˜ä¿®å¤**

- **"SyntaxError: Not support non-string message"**
  â†’ æ£€æŸ¥ JSON æ–‡ä»¶æ ¼å¼ï¼Œç¡®ä¿æ‰€æœ‰å€¼éƒ½æ˜¯å­—ç¬¦ä¸²

- **"$t is not a function"**
  â†’ æ£€æŸ¥ main.ts ä¸­æ˜¯å¦æ­£ç¡®æ³¨å†Œäº† i18n

- **"useI18n() is called but not in setup function"**
  â†’ ç¡®ä¿åœ¨ `<script setup>` ä¸­ä½¿ç”¨ useI18n

---

## âœ… **å®Œæˆæ£€æŸ¥æ¸…å•**

- [ ] ä¾èµ–å®‰è£…æ­£ç¡®
- [ ] æ–‡ä»¶ç»“æ„åˆ›å»ºå®Œæˆ
- [ ] è¯­è¨€æ–‡ä»¶æ ¼å¼æ­£ç¡®
- [ ] i18n é…ç½®æ­£ç¡®
- [ ] main.ts é…ç½®æ­£ç¡®
- [ ] ç»„ä»¶åˆ›å»ºæ­£ç¡®
- [ ] Vite é…ç½®æ›´æ–°
- [ ] é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] è¯­è¨€åˆ‡æ¢åŠŸèƒ½æ­£å¸¸
- [ ] æ§åˆ¶å°æ— é”™è¯¯

**æŒ‰ç…§è¿™ä¸ªæ–‡æ¡£æ“ä½œï¼Œé—®é¢˜åº”è¯¥èƒ½å¤Ÿå®Œå…¨è§£å†³ï¼** ğŸ‰
